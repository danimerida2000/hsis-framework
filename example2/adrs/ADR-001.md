# ADR-001: Use Prisma ORM for Data Access

## Status
Accepted

## Date
2024-01-21

## Deciders
- Architect Agent (Codex CLI)

---

## Context

### Problem Statement
We need a data access layer for the Task entity. The question is whether to use raw SQL queries, a query builder, or a full ORM.

### Driving Forces
- **NFR-001/002**: Performance requirements demand efficient queries
- **Existing Stack**: Team already uses Node.js/TypeScript
- **Maintainability**: Type safety reduces runtime errors
- **Developer Velocity**: Quick iteration needed for MVP

---

## Decision

**Use Prisma ORM** for all database operations in the task management module.

### Implementation
```typescript
// prisma/schema.prisma
model Task {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  title       String    @db.VarChar(255)
  description String?
  dueDate     DateTime? @map("due_date")
  priority    Priority  @default(MEDIUM)
  isCompleted Boolean   @default(false) @map("is_completed")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isCompleted])
  @@map("tasks")
}

enum Priority {
  LOW    @map("low")
  MEDIUM @map("medium")
  HIGH   @map("high")
}
```

---

## Consequences

### Positive
- **Type Safety**: Generated types match database schema exactly
- **Migrations**: Built-in migration system
- **Developer Experience**: Excellent IDE autocomplete
- **Performance**: Query optimization, connection pooling built-in

### Negative
- **Learning Curve**: Team needs to learn Prisma syntax
- **Build Step**: Requires code generation step
- **Abstraction**: Some complex queries harder than raw SQL

---

## Alternatives Considered

### Alternative 1: Raw SQL with pg driver
**Rejected**: No type safety, more boilerplate, higher bug risk

### Alternative 2: Knex Query Builder
**Rejected**: Less type safety than Prisma, more verbose for simple CRUD

### Alternative 3: TypeORM
**Rejected**: Heavier, more complex setup, Prisma is simpler for this use case

---

## Links
- PRD: FR-001 through FR-007 (all CRUD operations)
- Tests: tests/unit/task.repository.test.ts
